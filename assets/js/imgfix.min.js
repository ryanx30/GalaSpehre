"use strict";

(function(a) {
    function t(t) {
        var i = a(a(t).parents(".imgfix_wrapper_layer")[0]),
            s = a(i.parents(".imgfix_top_container")[0]),
            r = a(t).width(),
            f = a(t).height(),
            l = i.width(),
            d = i.height(),
            n = l / r,
            o = r * n,
            u = f * n;

        if (s.data("fix-fixin")) {
            if (u > d) {
                n = d / f;
                o = r * n;
                u = f * n;
            }
        } else if (d > u) {
            n = d / f;
            o = r * n;
            u = f * n;
        }

        var x = i[0].id;
        a("#imgfix_img_style_for_" + x).remove();
        var c = "";

        if (s.data("fix-defaults-grayscale") != null || 
            s.data("fix-defaults-sepia") != null || 
            s.data("fix-defaults-hue") != null || 
            s.data("fix-defaults-saturate") != null || 
            s.data("fix-defaults-invert") != null || 
            s.data("fix-defaults-brightness") != null || 
            s.data("fix-defaults-contrast") != null || 
            s.data("fix-defaults-blur") != null) {
            c = (s.data("fix-defaults-grayscale") != null ? "grayscale(" + parseInt(s.data("fix-defaults-grayscale")) + "%) " : "") +
                (s.data("fix-defaults-sepia") != null ? "sepia(" + parseInt(s.data("fix-defaults-sepia")) + "%) " : "") +
                (s.data("fix-defaults-hue") != null ? "hue-rotate(" + parseInt(s.data("fix-defaults-hue")) + "deg) " : "") +
                (s.data("fix-defaults-saturate") != null ? "saturate(" + parseInt(s.data("fix-defaults-saturate")) + "%) " : "") +
                (s.data("fix-defaults-invert") != null ? "invert(" + parseInt(s.data("fix-defaults-invert")) + "%) " : "") +
                (s.data("fix-defaults-brightness") != null ? "brightness(" + parseInt(s.data("fix-defaults-brightness")) + "%) " : "") +
                (s.data("fix-defaults-contrast") != null ? "contrast(" + parseInt(s.data("fix-defaults-contrast")) + "%) " : "") +
                (s.data("fix-defaults-blur") != null ? "blur(" + parseInt(s.data("fix-defaults-blur")) + "px) " : "");
        }

        if (c) {
            c = "filter: " + c + "; -webkit-filter: " + c + ";";
        }

        var p = "";
        if (s.data("fix-grayscale") != null || 
            s.data("fix-sepia") != null || 
            s.data("fix-hue") != null || 
            s.data("fix-saturate") != null || 
            s.data("fix-invert") != null || 
            s.data("fix-brightness") != null || 
            s.data("fix-contrast") != null || 
            s.data("fix-blur") != null) {
            p = (s.data("fix-grayscale") != null ? "grayscale(" + parseInt(s.data("fix-grayscale")) + "%) " : 
                s.data("fix-defaults-grayscale") != null ? "grayscale(" + parseInt(s.data("fix-defaults-grayscale")) + "%) " : "") +
                (s.data("fix-sepia") != null ? "sepia(" + parseInt(s.data("fix-sepia")) + "%) " : 
                s.data("fix-defaults-sepia") != null ? "sepia(" + parseInt(s.data("fix-defaults-sepia")) + "%) " : "") +
                (s.data("fix-hue") != null ? "hue-rotate(" + parseInt(s.data("fix-hue")) + "deg) " : 
                s.data("fix-defaults-hue") != null ? "hue-rotate(" + parseInt(s.data("fix-defaults-hue")) + "deg) " : "") +
                (s.data("fix-saturate") != null ? "saturate(" + parseInt(s.data("fix-saturate")) + "%) " : 
                s.data("fix-defaults-saturate") != null ? "saturate(" + parseInt(s.data("fix-defaults-saturate")) + "%) " : "") +
                (s.data("fix-invert") != null ? "invert(" + parseInt(s.data("fix-invert")) + "%) " : 
                s.data("fix-defaults-invert") != null ? "invert(" + parseInt(s.data("fix-defaults-invert")) + "%) " : "") +
                (s.data("fix-brightness") != null ? "brightness(" + parseInt(s.data("fix-brightness")) + "%) " : 
                s.data("fix-defaults-brightness") != null ? "brightness(" + parseInt(s.data("fix-defaults-brightness")) + "%) " : "") +
                (s.data("fix-contrast") != null ? "contrast(" + parseInt(s.data("fix-contrast")) + "%) " : 
                s.data("fix-defaults-contrast") != null ? "contrast(" + parseInt(s.data("fix-defaults-contrast")) + "%) " : "") +
                (s.data("fix-blur") != null ? "blur(" + parseInt(s.data("fix-blur")) + "px) " : 
                s.data("fix-defaults-blur") != null ? "blur(" + parseInt(s.data("fix-defaults-blur")) + "px) " : "");
        }

        if (p) {
            p = "filter: " + p + " !important; -webkit-filter: " + p + " !important;";
        }

        a("head").append('<style id="imgfix_img_style_for_' + x + '">' +
            '#' + x + ' .imgfix_src_img{left: -999999px;right: -999999px;top: -999999px;bottom: -999999px;z-index: 0;width: ' +
            parseInt(o + 1) + "px;height: " + parseInt(u + 1) + "px;max-width: auto !important; min-width: auto !important;position: absolute;margin: auto;-webkit-transition: all " +
            parseInt(s.data("fix-interval")) / 1000 + "s " + s.data("fix-easing") + ";transition: all " +
            parseInt(s.data("fix-interval")) / 1000 + "s " + s.data("fix-easing") + ";-webkit-transform: scale(" +
            s.data("fix-defaults-scale") + ");-ms-transform: scale(" + s.data("fix-defaults-scale") + ");transform: scale(" +
            s.data("fix-defaults-scale") + ");" + c + 
            '}#' + x + ':hover .imgfix_src_img{-webkit-transform: scale(' + s.data("fix-scale") + ');-ms-transform: scale(' + s.data("fix-scale") + ');transform: scale(' + s.data("fix-scale") + ');' + p + 
            '}</style>');
        e(t);
    }

    function e(t) {
        setTimeout(function() {
            a(t).css({ opacity: a(t).data("fix-img-default-opacity") });
        }, 1);
    }

    function i(t, e) {
        a("#imgfix_cover_slide_for_" + e).remove();
        var i = a(t).parents(".imgfix_top_container")[0];
        a(i).off();
        var r = t.data("slide");
        switch (s(t), r) {
            case "in-up":
            case "in-right":
            case "in-down":
            case "in-left":
            case "out-up":
            case "out-right":
            case "out-down":
            case "out-left":
                t.addClass("imgfix-" + r);
                break;
            case "dynamic":
                t.addClass("imgfix-in-up");
                a(i).on("mouseenter", t, function(t) {
                    var e = t.data.parents(".imgfix_wrapper_layer")[0].id.split("_")[3],
                        i = a(l.family[e].element);
                    a(this).find(".imgfix_cover_wrapper").removeClass("imgfix-in-up-right");
                    a(this).find(".imgfix_cover_wrapper").removeClass("imgfix-in-up-left");
                    a(this).find(".imgfix_cover_wrapper").removeClass("imgfix-in-down-right");
                    a(this).find(".imgfix_cover_wrapper").removeClass("imgfix-in-down-left");
                    for (var r = 0; r < i.length; r++) {
                        var f = i[r];
                        if (f != this) {
                            var d = "";
                            a(f).offset().top > a(this).offset().top ? d = "down" : d = "up";
                            a(f).find(".imgfix_cover_wrapper").addClass("imgfix-in-" + d + "-left");
                        }
                    }
                });
                break;
        }
    }

    function s(t) {
        var e = a(t).parents(".imgfix_top_container")[0];
        if (t.data("fix-multiple-covers")) {
            a(e).find(".imgfix_cover_wrapper").css("opacity", "0");
        }
    }

    var l = {
        family: [],
        createFamily: function(t) {
            l.family[t] = {};
        },
        addElementToFamily: function(t, e) {
            if (!l.family[t]) {
                l.createFamily(t);
            }
            if (!l.family[t].element) {
                l.family[t].element = [];
            }
            l.family[t].element.push(e);
        }
    };

    a.fn.imgfix = function(e) {
        var r = a.extend({
            fix_defaults_grayscale: 0,
            fix_defaults_sepia: 0,
            fix_defaults_hue: 0,
            fix_defaults_saturate: 100,
            fix_defaults_invert: 0,
            fix_defaults_brightness: 100,
            fix_defaults_contrast: 100,
            fix_defaults_blur: 0,
            fix_scale: 1,
            fix_defaults_scale: 1,
            fix_interval: 400,
            fix_easing: "ease-in-out",
            fix_img_default_opacity: 1,
            fix_multiple_covers: false,
            fix_fixin: false,
            fix_image: false
        }, e);
        
        return this.each(function() {
            var t = a(this),
                e = t.data("fixed") || false;

            if (e) return;

            t.data("fix-fixin", true);
            t.data("fix-defaults-grayscale", r.fix_defaults_grayscale);
            t.data("fix-defaults-sepia", r.fix_defaults_sepia);
            t.data("fix-defaults-hue", r.fix_defaults_hue);
            t.data("fix-defaults-saturate", r.fix_defaults_saturate);
            t.data("fix-defaults-invert", r.fix_defaults_invert);
            t.data("fix-defaults-brightness", r.fix_defaults_brightness);
            t.data("fix-defaults-contrast", r.fix_defaults_contrast);
            t.data("fix-defaults-blur", r.fix_defaults_blur);
            t.data("fix-scale", r.fix_scale);
            t.data("fix-defaults-scale", r.fix_defaults_scale);
            t.data("fix-interval", r.fix_interval);
            t.data("fix-easing", r.fix_easing);
            t.data("fix-img-default-opacity", r.fix_img_default_opacity);
            t.data("fix-multiple-covers", r.fix_multiple_covers);
            l.addElementToFamily(t.data("fix-family") || "default", t[0]);
            t.on("load", function() {
                t.removeData("fix-fixin");
                t.data("fixed", true);
                t.css({ opacity: 0 });
                t.addClass("imgfix_wrapper_layer");
                t.wrap('<div class="imgfix_top_container" />');
                var e = t.parent(),
                    i = a("<div class='imgfix_cover_wrapper'></div>");

                e.append(i);
                i.css({
                    position: "absolute",
                    width: "100%",
                    height: "100%",
                    top: 0,
                    left: 0,
                    opacity: 0,
                    background: t.css("background"),
                    zIndex: 1
                });
                a(this).css({
                    position: "absolute",
                    top: 0,
                    left: 0,
                    zIndex: 0
                });
                t.data("fix-family") && i.addClass(t.data("fix-family"));

                i.on("mouseenter", function() {
                    i.addClass("imgfix_cover_active");
                    i.css({ opacity: 1 });
                    t.data("fix-family") && i.addClass(t.data("fix-family"));
                });

                i.on("mouseleave", function() {
                    i.removeClass("imgfix_cover_active");
                    i.css({ opacity: 0 });
                });

                i.data("fix-non-animated") && i.addClass("imgfix_cover_non_animated");

                i.addClass("imgfix_cover");
                t.width(t.width()).height(t.height());
                t.hide();
                i.css("background-image", "url(" + t.attr("src") + ")");
                t.data("fixed", true);
                t.addClass("imgfix_img");
                t.attr("id", "imgfix_img_" + Math.round(Math.random() * 1e5));
                t.data("fix-defaults-opacity", t.css("opacity"));
                t.data("imgfix_img_index", l.family.length);
                l.addElementToFamily(t.data("fix-family") || "default", t[0]);
                t.data("fix-image", true);
                t.on("load", function() {
                    t.removeData("fix-fixin");
                    t.data("fixed", true);
                    t.css({ opacity: 0 });
                    t.addClass("imgfix_wrapper_layer");
                    t.wrap('<div class="imgfix_top_container" />');
                    var e = t.parent(),
                        i = a("<div class='imgfix_cover_wrapper'></div>");

                    e.append(i);
                    i.css({
                        position: "absolute",
                        width: "100%",
                        height: "100%",
                        top: 0,
                        left: 0,
                        opacity: 0,
                        background: t.css("background"),
                        zIndex: 1
                    });
                    a(this).css({
                        position: "absolute",
                        top: 0,
                        left: 0,
                        zIndex: 0
                    });
                    t.data("fix-family") && i.addClass(t.data("fix-family"));
                    i.on("mouseenter", function() {
                        i.addClass("imgfix_cover_active");
                        i.css({ opacity: 1 });
                        t.data("fix-family") && i.addClass(t.data("fix-family"));
                    });

                    i.on("mouseleave", function() {
                        i.removeClass("imgfix_cover_active");
                        i.css({ opacity: 0 });
                    });

                    i.data("fix-non-animated") && i.addClass("imgfix_cover_non_animated");
                    i.addClass("imgfix_cover");
                    t.width(t.width()).height(t.height());
                    t.hide();
                    i.css("background-image", "url(" + t.attr("src") + ")");
                    t.data("fix-family") && i.addClass(t.data("fix-family"));
                    t.data("fixed", true);
                    t.data("fix-family") && i.addClass(t.data("fix-family"));
                    t.data("fix-image", true);
                    t.on("load", function() {
                        t.removeData("fix-fixin");
                        t.data("fixed", true);
                        t.css({ opacity: 0 });
                        t.addClass("imgfix_wrapper_layer");
                        t.wrap('<div class="imgfix_top_container" />');
                        var e = t.parent(),
                            i = a("<div class='imgfix_cover_wrapper'></div>");

                        e.append(i);
                        i.css({
                            position: "absolute",
                            width: "100%",
                            height: "100%",
                            top: 0,
                            left: 0,
                            opacity: 0,
                            background: t.css("background"),
                            zIndex: 1
                        });
                        a(this).css({
                            position: "absolute",
                            top: 0,
                            left: 0,
                            zIndex: 0
                        });
                        t.data("fix-family") && i.addClass(t.data("fix-family"));
                        i.on("mouseenter", function() {
                            i.addClass("imgfix_cover_active");
                            i.css({ opacity: 1 });
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                        });

                        i.on("mouseleave", function() {
                            i.removeClass("imgfix_cover_active");
                            i.css({ opacity: 0 });
                        });

                        i.data("fix-non-animated") && i.addClass("imgfix_cover_non_animated");
                        i.addClass("imgfix_cover");
                        t.width(t.width()).height(t.height());
                        t.hide();
                        i.css("background-image", "url(" + t.attr("src") + ")");
                        t.data("fix-family") && i.addClass(t.data("fix-family"));
                        t.data("fixed", true);
                        t.data("fix-family") && i.addClass(t.data("fix-family"));
                        t.data("fix-image", true);
                        t.data("fix-family") && i.addClass(t.data("fix-family"));
                        t.on("load", function() {
                            t.removeData("fix-fixin");
                            t.data("fixed", true);
                            t.css({ opacity: 0 });
                            t.addClass("imgfix_wrapper_layer");
                            t.wrap('<div class="imgfix_top_container" />');
                            var e = t.parent(),
                                i = a("<div class='imgfix_cover_wrapper'></div>");

                            e.append(i);
                            i.css({
                                position: "absolute",
                                width: "100%",
                                height: "100%",
                                top: 0,
                                left: 0,
                                opacity: 0,
                                background: t.css("background"),
                                zIndex: 1
                            });
                            a(this).css({
                                position: "absolute",
                                top: 0,
                                left: 0,
                                zIndex: 0
                            });
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                            i.on("mouseenter", function() {
                                i.addClass("imgfix_cover_active");
                                i.css({ opacity: 1 });
                                t.data("fix-family") && i.addClass(t.data("fix-family"));
                            });

                            i.on("mouseleave", function() {
                                i.removeClass("imgfix_cover_active");
                                i.css({ opacity: 0 });
                            });

                            i.data("fix-non-animated") && i.addClass("imgfix_cover_non_animated");
                            i.addClass("imgfix_cover");
                            t.width(t.width()).height(t.height());
                            t.hide();
                            i.css("background-image", "url(" + t.attr("src") + ")");
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                            t.data("fixed", true);
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                            t.data("fix-image", true);
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                            t.data("fix-family") && i.addClass(t.data("fix-family"));
                        });
                    });
                });
            });
        });
    };
}(jQuery));
